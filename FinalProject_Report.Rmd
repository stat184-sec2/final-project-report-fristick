---
title: "Final Project Report"
author: "Hunter Fristick"
date: "Due: 12/15/2021"
output: html_notebook
---

# Set Up

### Clean up environment and load packages
```{r}
# clean up the RStudio environment 
rm(list = ls())

# load all packages here: 
library(mosaic)
library(tidyr)
library(rvest)

```
### Research Question
  


### Data Access

```{r}
Salaries <- readr::read_csv('C:\\Users\\frist\\OneDrive\\Documents\\Penn State\\STAT 184\\Github Repository\\final-project-report-fristick\\Salaries.csv')
```

```{r}
web_page <- "https://www.baseball-reference.com/leagues/NL/#teams_team_wins3000"
SetOfTables <- web_page %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)

NLWinsandLosses <- SetOfTables[[1]]
```

```{r}
web_pageAL <- "https://www.baseball-reference.com/leagues/AL/#teams_team_wins3000"
SetOfTables <- web_pageAL %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)

ALWinsandLosses <- SetOfTables[[1]]
```

```{r}
head(Salaries)
```


```{r}
head(NLWinsandLosses)
```

```{r}
summary(ALWinsandLosses)
```

```{r}
summary(Salaries)
```

### Data Wrangling / Cleaning

```{r}
 NLWinsLonger <-
    NLWinsandLosses %>%
    pivot_longer(cols = c(ARI, ATL, CHC, CIN, COL, HOU, LAD, MIA, MIL, NYM, PHI, PIT, SDP, SFG, STL, WSN), names_to = "Team", values_to = "Wins")

ALWinsLonger <-
    ALWinsandLosses %>%
    pivot_longer(cols = c(BAL, BLA, BOS, CHW, CLE, DET, HOU, KCR, LAA, MIL, MIN, NYY, OAK, SEA, TBR, TEX, TOR), names_to = "Team", values_to = "Wins") 
WinsLonger <- rbind(NLWinsLonger, ALWinsLonger)
```

In this step I am pivoting both NLWinsandLosses ALWinsandLosses into a narrow form.  Then I am binding both tables together so that I can use them as one table.  I need to pivot them to make the data easier to use and graph later on in the project.

```{r}
HighestWinsbyYear <-
  WinsLonger %>%
  group_by(Year) %>%
  filter(Year >= 1985 & Year <= 2016 & Year != 'Year') %>%
  summarise(MostWins = max(Wins), Team)

  
HighestWinsbyYear
```
```{r}
SalSum <-
  Salaries %>%
  group_by(yearID = as.character(yearID), teamID) %>%
  summarise(totalSal = sum(salary)) 

SalSum
```

```{r}
JoinedData <-
  SalSum %>%
  inner_join(WinsLonger, by = c("yearID" = "Year", "teamID" = "Team")) %>%
  group_by(yearID = as.double(yearID)) %>%
  na_if('') %>%
  drop_na()

JoinedData
```
In this query I am join the SalSum data with the WinsLonger data.  This will allow me to analyze the salaries based on how many wins each team has throughout the years. I joined the data based on matching year and team name data and I used an inner join to ensure that only the data that matched was selected so that I didn't have N/A values in my new table.

```{r}
AvgSal <-
  JoinedData %>%
   group_by(yearID = as.double(yearID)) %>%
  summarise(avgSal = mean(totalSal))

AvgSal
```
This query shows the average salary of all teams for each year in the data from 1985 to 2016.

```{r}
Total90s <-
  JoinedData %>%
  filter(grepl('..9.', yearID, ignore.case = TRUE)) %>%
  summarise(count = n())

Total90s
```

This query uses a regular expression to to grab all of the years in the data who are included in the 90s. this is done by filter the data to only include years with a 9 in the third place.  I then summaries how many cases there were for each year of data.

```{r}
JoinedData %>%
  group_by(yearID) %>%
  mutate(x = max(totalSal) - min(totalSal)) %>%
  summarise(yearID, x) %>%
  unique() %>%
  filter(yearID == 1985 | yearID == 2016)
 
```
This query shows how the total difference in salaries per team has increased over the years.  In 1985 there was 10,194,000 between the highest and lowest salary and in 2016 there was 135,896,481. So as time has increased, the gap between the lowest and highest salary has increased tremendously.

### Data Visualization

```{r}
JoinedData %>%
  ggplot(aes(x = yearID, y = totalSal, color = teamID)) +
  geom_point() +
  ylab('Team Salaries')
```
This graphic shows the team salaries based on the year.  Each color represents a different team on the graphic. For example, the team with the highest salary overall is the green dot in the upper right corner. From looking at this image, you can see that salaries have increased overtime. This is because as baseball has gotten more popular, more money has been put into the sport. What this also shows is as the years go on, there is a larger difference between the smallest and largest salary.

```{r}
JoinedData %>%
  ggplot(aes(x = totalSal, color = Wins)) +
  geom_density() 
```


